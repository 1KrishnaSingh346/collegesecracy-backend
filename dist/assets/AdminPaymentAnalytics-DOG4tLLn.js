const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/react-apexcharts.min-BOHl76WV.js","assets/index-os3KaEe5.js","assets/index-6SBP7lGn.css","assets/index-Chjiymov.js"])))=>i.map(i=>d[i]);
import{j as e,ag as $,u as xe,r as j,ah as me,ai as fe,g as be,k as ye,y as pe,I as we,aj as je,ak as ve,al as Ne}from"./index-os3KaEe5.js";import{Document as Se,Page as ke,View as w,Text as n,StyleSheet as De,Font as Te,PDFDownloadLink as Ae}from"./react-pdf.browser-CGvlFbzg.js";import{u as L,w as Fe}from"./xlsx-fdabpkSu.js";Te.register({family:"Helvetica",fonts:[{src:"https://cdnjs.cloudflare.com/ajax/libs/ink/3.1.10/fonts/Roboto/roboto-regular-webfont.ttf"},{src:"https://cdnjs.cloudflare.com/ajax/libs/ink/3.1.10/fonts/Roboto/roboto-bold-webfont.ttf",fontWeight:"bold"}]});const u=De.create({page:{paddingTop:35,paddingBottom:65,paddingHorizontal:35,fontFamily:"Helvetica"},smallFontPage:{paddingTop:30,paddingBottom:60,paddingHorizontal:30,fontFamily:"Helvetica",fontSize:8},header:{marginBottom:15,textAlign:"center"},logoText:{fontSize:14,fontWeight:"bold",color:"#3B82F6",marginBottom:5},title:{fontSize:18,fontWeight:"bold",color:"#1F2937",marginBottom:5},subtitle:{fontSize:10,color:"#6B7280",marginBottom:10},section:{marginBottom:10},sectionTitle:{fontSize:12,fontWeight:"bold",color:"#111827",marginBottom:5,borderBottom:"1 solid #e5e7eb",paddingBottom:3},smallSectionTitle:{fontSize:10,fontWeight:"bold",color:"#111827",marginBottom:4,borderBottom:"1 solid #e5e7eb",paddingBottom:2},table:{width:"100%",borderStyle:"solid",borderWidth:1,borderColor:"#e5e7eb",marginBottom:8},smallTable:{width:"100%",borderStyle:"solid",borderWidth:1,borderColor:"#e5e7eb",marginBottom:6,fontSize:8},tableRow:{flexDirection:"row",borderBottomWidth:1,borderBottomColor:"#e5e7eb",alignItems:"center",minHeight:22},smallTableRow:{flexDirection:"row",borderBottomWidth:1,borderBottomColor:"#e5e7eb",alignItems:"center",minHeight:18},headerRow:{backgroundColor:"#f3f4f6",fontWeight:"bold"},cell:{paddingVertical:4,paddingHorizontal:6,fontSize:9,flex:1,textAlign:"left",borderRightWidth:1,borderRightColor:"#e5e7eb"},smallCell:{paddingVertical:3,paddingHorizontal:5,fontSize:7,flex:1,textAlign:"left",borderRightWidth:1,borderRightColor:"#e5e7eb"},cellHeader:{fontWeight:"bold",fontSize:10,color:"#111827"},smallCellHeader:{fontWeight:"bold",fontSize:8,color:"#111827"},cellNoBorder:{borderRightWidth:0},totalContainer:{marginTop:8,textAlign:"right"},totalText:{fontSize:11,fontWeight:"bold"},smallTotalText:{fontSize:9,fontWeight:"bold"},footer:{position:"absolute",bottom:25,left:0,right:0,textAlign:"center",fontSize:9,color:"#9CA3AF",borderTopWidth:1,borderTopColor:"#e5e7eb",paddingTop:5},smallFooter:{position:"absolute",bottom:20,left:0,right:0,textAlign:"center",fontSize:8,color:"#9CA3AF",borderTopWidth:1,borderTopColor:"#e5e7eb",paddingTop:4},statsContainer:{flexDirection:"row",justifyContent:"space-between",marginBottom:12},smallStatsContainer:{flexDirection:"row",justifyContent:"space-between",marginBottom:8},statBox:{width:"32%",padding:6,backgroundColor:"#F3F4F6",borderRadius:4},smallStatBox:{width:"32%",padding:5,backgroundColor:"#F3F4F6",borderRadius:3},statLabel:{fontSize:9,color:"#6B7280",marginBottom:3},smallStatLabel:{fontSize:8,color:"#6B7280",marginBottom:2},statValue:{fontSize:12,fontWeight:"bold",color:"#111827"},smallStatValue:{fontSize:10,fontWeight:"bold",color:"#111827"},pageNumber:{position:"absolute",fontSize:10,bottom:10,left:0,right:0,textAlign:"center",color:"#6B7280"},smallPageNumber:{position:"absolute",fontSize:8,bottom:8,left:0,right:0,textAlign:"center",color:"#6B7280"}}),q=10,Re=15,Ce=({payments:y=[],stats:C={}})=>{const r=new Date().toLocaleDateString("en-IN"),k=y.reduce((l,o)=>l+(o.amount||0),0),m=l=>l?new Date(l).toLocaleDateString("en-IN"):"N/A",A=l=>l?new Date(l).toLocaleString("en-IN",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A",b=(l,o)=>{const t=[];for(let x=0;x<l.length;x+=o)t.push(l.slice(x,x+o));return t},v=y.length>q*3,N=v?Re:q,c=b(y,N),d=l=>l?{pageStyle:u.smallFontPage,sectionTitle:u.smallSectionTitle,table:u.smallTable,tableRow:u.smallTableRow,cell:u.smallCell,cellHeader:u.smallCellHeader,totalText:u.smallTotalText,footer:u.smallFooter,statsContainer:u.smallStatsContainer,statBox:u.smallStatBox,statLabel:u.smallStatLabel,statValue:u.smallStatValue,pageNumber:u.smallPageNumber}:{pageStyle:u.page,sectionTitle:u.sectionTitle,table:u.table,tableRow:u.tableRow,cell:u.cell,cellHeader:u.cellHeader,totalText:u.totalText,footer:u.footer,statsContainer:u.statsContainer,statBox:u.statBox,statLabel:u.statLabel,statValue:u.statValue,pageNumber:u.pageNumber};return e.jsx(Se,{children:c.map((l,o)=>{const t=d(v),x=o===0,p=o===c.length-1;return e.jsxs(ke,{size:"A4",style:t.pageStyle,wrap:!0,children:[x&&e.jsxs(w,{style:t.header,fixed:!0,children:[e.jsx(n,{style:u.logoText,children:"CollegeSecracy"}),e.jsx(n,{style:u.title,children:"Monthly Payment & Revenue Report"}),e.jsxs(n,{style:u.subtitle,children:["Powered by ACStudyCentre | Report Date: ",r]})]}),x&&Object.keys(C).length>0&&e.jsxs(w,{style:t.statsContainer,children:[e.jsxs(w,{style:t.statBox,children:[e.jsx(n,{style:t.statLabel,children:"Total Payments"}),e.jsx(n,{style:t.statValue,children:C.totalPayments||y.length})]}),e.jsxs(w,{style:t.statBox,children:[e.jsx(n,{style:t.statLabel,children:"Successful"}),e.jsx(n,{style:t.statValue,children:C.successfulPayments||y.filter(s=>s.status==="completed"||s.status==="paid").length})]}),e.jsxs(w,{style:t.statBox,children:[e.jsx(n,{style:t.statLabel,children:"Total Revenue"}),e.jsxs(n,{style:t.statValue,children:["â‚¹",k.toLocaleString("en-IN")]})]})]}),e.jsxs(w,{style:u.section,children:[e.jsxs(n,{style:t.sectionTitle,children:["Payment Summary (Page ",o+1," of ",c.length,")"]}),e.jsxs(w,{style:t.table,children:[e.jsxs(w,{style:[t.tableRow,t.headerRow],children:[e.jsx(n,{style:[t.cell,t.cellHeader,{flex:.5}],children:"S.No"}),e.jsx(n,{style:[t.cell,t.cellHeader],children:"Full Name"}),e.jsx(n,{style:[t.cell,t.cellHeader],children:"Email"}),e.jsx(n,{style:[t.cell,t.cellHeader],children:"Plan Name"}),e.jsx(n,{style:[t.cell,t.cellHeader,{flex:.7}],children:"Amount"}),e.jsx(n,{style:[t.cell,t.cellHeader,{flex:.7}],children:"Status"}),e.jsx(n,{style:[t.cell,t.cellHeader,{flex:.8,borderRightWidth:0}],children:"Date"})]}),l.map((s,B)=>{var D,z;const F=o*N+B;return e.jsxs(w,{style:t.tableRow,children:[e.jsx(n,{style:[t.cell,{flex:.5}],children:F+1}),e.jsx(n,{style:t.cell,children:s.fullName||((D=s.userId)==null?void 0:D.fullName)||"N/A"}),e.jsx(n,{style:t.cell,children:s.email||((z=s.userId)==null?void 0:z.email)||"N/A"}),e.jsx(n,{style:t.cell,children:s.PlanName||s.planName||s.plan||"Unknown"}),e.jsxs(n,{style:[t.cell,{flex:.7}],children:["â‚¹",(s.amount||0).toLocaleString("en-IN")]}),e.jsx(n,{style:[t.cell,{flex:.7}],children:s.status||"N/A"}),e.jsx(n,{style:[t.cell,{flex:.8,borderRightWidth:0}],children:m(s.createdAt)})]},F)})]}),p&&e.jsx(w,{style:t.totalContainer,children:e.jsxs(n,{style:t.totalText,children:["Total Revenue: â‚¹",k.toLocaleString("en-IN")]})})]}),e.jsxs(w,{style:u.section,children:[e.jsxs(n,{style:t.sectionTitle,children:["Transaction Details (Page ",o+1," of ",c.length,")"]}),e.jsxs(w,{style:t.table,children:[e.jsxs(w,{style:[t.tableRow,t.headerRow],children:[e.jsx(n,{style:[t.cell,t.cellHeader],children:"Email"}),e.jsx(n,{style:[t.cell,t.cellHeader,{flex:.8}],children:"Contact"}),e.jsx(n,{style:[t.cell,t.cellHeader,{flex:.8}],children:"Payment Method"}),e.jsx(n,{style:[t.cell,t.cellHeader],children:"Payment ID"}),e.jsx(n,{style:[t.cell,t.cellHeader],children:"Order ID"}),e.jsx(n,{style:[t.cell,t.cellHeader],children:"Receipt"}),e.jsx(n,{style:[t.cell,t.cellHeader,{flex:.9}],children:"Bought At"}),e.jsx(n,{style:[t.cell,t.cellHeader,{flex:.7,borderRightWidth:0}],children:"Valid Till"})]}),l.map((s,B)=>{var D;const F=o*N+B;return e.jsxs(w,{style:t.tableRow,children:[e.jsx(n,{style:t.cell,children:s.email||((D=s.userId)==null?void 0:D.email)||"N/A"}),e.jsx(n,{style:[t.cell,{flex:.8}],children:s.contact||"N/A"}),e.jsx(n,{style:[t.cell,{flex:.8}],children:s.paymentMethod||"N/A"}),e.jsx(n,{style:t.cell,children:s.paymentId||"N/A"}),e.jsx(n,{style:t.cell,children:s.orderId||"N/A"}),e.jsx(n,{style:t.cell,children:s.receipt||"N/A"}),e.jsx(n,{style:[t.cell,{flex:.9}],children:A(s.boughtAt||s.createdAt)}),e.jsx(n,{style:[t.cell,{flex:.7,borderRightWidth:0}],children:m(s.validity)})]},F)})]})]}),e.jsx(w,{style:t.footer,fixed:!0,children:e.jsxs(n,{children:["CollegeSecracy Â© ",new Date().getFullYear()," | All rights reserved"]})}),e.jsxs(n,{style:t.pageNumber,children:["Page ",o+1," of ",c.length]})]},o)})})};var I={exports:{}},Be=I.exports,K;function Le(){return K||(K=1,function(y,C){(function(r,k){k()})(Be,function(){function r(c,d){return typeof d>"u"?d={autoBom:!1}:typeof d!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),d={autoBom:!d}),d.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(c.type)?new Blob(["\uFEFF",c],{type:c.type}):c}function k(c,d,l){var o=new XMLHttpRequest;o.open("GET",c),o.responseType="blob",o.onload=function(){N(o.response,d,l)},o.onerror=function(){console.error("could not download file")},o.send()}function m(c){var d=new XMLHttpRequest;d.open("HEAD",c,!1);try{d.send()}catch{}return 200<=d.status&&299>=d.status}function A(c){try{c.dispatchEvent(new MouseEvent("click"))}catch{var d=document.createEvent("MouseEvents");d.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),c.dispatchEvent(d)}}var b=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof $=="object"&&$.global===$?$:void 0,v=b.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),N=b.saveAs||(typeof window!="object"||window!==b?function(){}:"download"in HTMLAnchorElement.prototype&&!v?function(c,d,l){var o=b.URL||b.webkitURL,t=document.createElement("a");d=d||c.name||"download",t.download=d,t.rel="noopener",typeof c=="string"?(t.href=c,t.origin===location.origin?A(t):m(t.href)?k(c,d,l):A(t,t.target="_blank")):(t.href=o.createObjectURL(c),setTimeout(function(){o.revokeObjectURL(t.href)},4e4),setTimeout(function(){A(t)},0))}:"msSaveOrOpenBlob"in navigator?function(c,d,l){if(d=d||c.name||"download",typeof c!="string")navigator.msSaveOrOpenBlob(r(c,l),d);else if(m(c))k(c,d,l);else{var o=document.createElement("a");o.href=c,o.target="_blank",setTimeout(function(){A(o)})}}:function(c,d,l,o){if(o=o||open("","_blank"),o&&(o.document.title=o.document.body.innerText="downloading..."),typeof c=="string")return k(c,d,l);var t=c.type==="application/octet-stream",x=/constructor/i.test(b.HTMLElement)||b.safari,p=/CriOS\/[\d]+/.test(navigator.userAgent);if((p||t&&x||v)&&typeof FileReader<"u"){var s=new FileReader;s.onloadend=function(){var D=s.result;D=p?D:D.replace(/^data:[^;]*;/,"data:attachment/file;"),o?o.location.href=D:location=D,o=null},s.readAsDataURL(c)}else{var B=b.URL||b.webkitURL,F=B.createObjectURL(c);o?o.location=F:location.href=F,o=null,setTimeout(function(){B.revokeObjectURL(F)},4e4)}});b.saveAs=N.saveAs=N,y.exports=N})}(I)),I.exports}var Ee=Le();function ze(y=[]){var C;try{if(!y||!y.length){console.warn("No data available for Excel export");return}const r=y.map(l=>{var x,p,s;const o=l.boughtAt||l.createdAt,t=l.validity;return{"S.No":y.indexOf(l)+1,"Order ID":l.orderId||"N/A","Transaction ID":l.paymentId||l.transactionId||"N/A","Receipt ID":l.receipt||"N/A","Full Name":l.fullName||((x=l.userId)==null?void 0:x.fullName)||"N/A",Email:l.email||((p=l.userId)==null?void 0:p.email)||"N/A",Contact:l.contact||((s=l.userId)==null?void 0:s.phone)||"N/A","Plan Name":l.PlanName||l.planName||l.plan||"Unknown","Amount (â‚¹)":l.amount?Number(l.amount):0,Currency:l.currency||"INR","Payment Method":l.paymentMethod||"N/A",Status:l.status||"N/A","Transaction Date":o?new Date(o):null,"Valid Till":t?new Date(t):"Lifetime","Is Bundle":l.isBundle?"Yes":"No","Coupon Used":l.couponUsed||"None",Bank:l.bank||"N/A",Wallet:l.wallet||"N/A"}}),k=L.book_new(),m=L.json_to_sheet(r);if(!m["!ref"])throw new Error("Failed to create transaction sheet");m["!autofilter"]={ref:m["!ref"]},m["!cols"]=[{wch:5},{wch:20},{wch:20},{wch:15},{wch:20},{wch:25},{wch:15},{wch:20},{wch:12},{wch:10},{wch:15},{wch:12},{wch:20},{wch:15},{wch:10},{wch:15},{wch:15},{wch:15}],L.book_append_sheet(k,m,"Transaction Details");const A="dd-mm-yyyy hh:mm:ss",b='"â‚¹"#,##0.00',v=L.decode_range(m["!ref"]);for(let l=v.s.c;l<=v.e.c;++l){const o=L.encode_col(l)+"1",t=(C=m[o])==null?void 0:C.v;if(t!=null&&t.includes("Date")||t==="Valid Till")for(let x=v.s.r;x<=v.e.r;++x){const p=L.encode_cell({r:x,c:l});m[p]&&(m[p].z=A)}if(t==="Amount (â‚¹)")for(let x=v.s.r;x<=v.e.r;++x){const p=L.encode_cell({r:x,c:l});m[p]&&(m[p].z=b)}}const c=`CollegeSecracy_Transactions_${new Date().toISOString().slice(0,10).replace(/-/g,"")}.xlsx`,d=Fe(k,{bookType:"xlsx",type:"array",cellDates:!0});Ee.saveAs(new Blob([d],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),c)}catch(r){console.error("Error exporting to Excel:",r)}}const O=j.lazy(()=>Ne(()=>import("./react-apexcharts.min-BOHl76WV.js").then(y=>y.r),__vite__mapDeps([0,1,2,3]))),Me=()=>{const{payments:y,getAllPayments:C}=xe(),[r,k]=j.useState(typeof window<"u"&&localStorage.getItem("theme")||"light"),[m,A]=j.useState([]),[b,v]=j.useState(""),[N,c]=j.useState("all"),[d,l]=j.useState("all"),[o,t]=j.useState(""),[x,p]=j.useState(""),[s,B]=j.useState({totalRevenue:0,activeSubscriptions:0,totalTransactions:0,failedTransactions:0,monthlyRevenue:[],weeklyRevenue:[],dailyRevenue:[],planDistribution:[]}),F=()=>{const a=r==="light"?"dark":"light";k(a),typeof window<"u"&&localStorage.setItem("theme",a)};j.useEffect(()=>{document.body.className=r},[r]),j.useEffect(()=>{C()},[]),j.useEffect(()=>{y&&y.length>0&&D()},[y,b,N,d,o,x]);const D=()=>{let a=y;if(N!=="all"&&(a=a.filter(i=>i.status===N)),b&&(a=a.filter(i=>{var T,S;return((S=(T=i.userId)==null?void 0:T.email)==null?void 0:S.toLowerCase().includes(b.toLowerCase()))||i.email&&i.email.toLowerCase().includes(b.toLowerCase())})),d!=="all"){const i=new Date;a=a.filter(T=>{const S=new Date(T.createdAt||T.boughtAt);switch(d){case"today":return z(S,i);case"week":return Q(S,i);case"month":return X(S,i);case"year":return J(S,i);case"custom":if(o&&x){const P=new Date(o),E=new Date(x);return S>=P&&S<=E}return!0;default:return!0}})}A(a),Z(a)},z=(a,i)=>a.getDate()===i.getDate()&&a.getMonth()===i.getMonth()&&a.getFullYear()===i.getFullYear(),Q=(a,i)=>Math.round(Math.abs((a-i)/864e5))<=7&&a.getMonth()===i.getMonth(),X=(a,i)=>a.getMonth()===i.getMonth()&&a.getFullYear()===i.getFullYear(),J=(a,i)=>a.getFullYear()===i.getFullYear(),Z=a=>{const i=a.reduce((h,g)=>h+(g.amount||0),0),T=a.filter(h=>h.status==="paid").length,S=a.length,P=a.filter(h=>h.status==="failed").length,E={};a.forEach(h=>{const g=new Date(h.createdAt||h.boughtAt),R=`${g.getFullYear()}-${g.getMonth()+1}`;E[R]=(E[R]||0)+(h.amount||0)});const ie=Object.entries(E).map(([h,g])=>{const[R,ge]=h.split("-").map(Number),G=new Date(R,ge-1);return{month:G.toLocaleString("default",{month:"short",year:"numeric"}),revenue:g,date:G}}).sort((h,g)=>h.date-g.date).map(({month:h,revenue:g})=>({month:h,revenue:g})),H={};a.forEach(h=>{const g=new Date(h.createdAt||h.boughtAt),R=`Week ${ee(g)}, ${g.getFullYear()}`;H[R]=(H[R]||0)+(h.amount||0)});const ce=Object.entries(H).map(([h,g])=>({week:h,revenue:g})),_={},Y=new Date,de=new Date(Y.setDate(Y.getDate()-30));a.forEach(h=>{const g=new Date(h.createdAt||h.boughtAt);if(g>=de){const R=g.toLocaleDateString("en-CA");_[R]=(_[R]||0)+(h.amount||0)}});const he=Object.entries(_).map(([h,g])=>({day:h,revenue:g,date:new Date(h)})).sort((h,g)=>h.date-g.date).map(({day:h,revenue:g})=>({day:h,revenue:g})),W={};a.forEach(h=>{const g=h.PlanName||h.plan||"Unknown";W[g]=(W[g]||0)+1});const ue=Object.entries(W).map(([h,g])=>({name:h,value:g}));B({totalRevenue:i,activeSubscriptions:T,totalTransactions:S,failedTransactions:P,monthlyRevenue:ie,weeklyRevenue:ce,dailyRevenue:he,planDistribution:ue})},ee=a=>{const i=new Date(Date.UTC(a.getFullYear(),a.getMonth(),a.getDate())),T=i.getUTCDay()||7;i.setUTCDate(i.getUTCDate()+4-T);const S=new Date(Date.UTC(i.getUTCFullYear(),0,1));return Math.ceil(((i-S)/864e5+1)/7)},U={light:{text:"#6B7280",background:"#ffffff",grid:"#E5E7EB",primary:"#4F46E5",success:"#10B981",warning:"#F59E0B",danger:"#EF4444",chartBg:"#ffffff",chartText:"#111827",chartGrid:"#E5E7EB"},dark:{text:"#9CA3AF",background:"#1F2937",grid:"#374151",primary:"#818CF8",success:"#34D399",warning:"#FBBF24",danger:"#F87171",chartBg:"#1F2937",chartText:"#F3F4F6",chartGrid:"#374151"}},f=U[r]||U.light,V=()=>{var a;return{chart:{type:"bar",height:350,toolbar:{show:!0,tools:{download:!0,selection:!0,zoom:!0,zoomin:!0,zoomout:!0,pan:!0,reset:!0}},background:f.chartBg,foreColor:f.chartText,animations:{enabled:!0,easing:"easeinout",speed:800}},colors:[f.primary],plotOptions:{bar:{borderRadius:4,horizontal:!1,columnWidth:"55%"}},dataLabels:{enabled:!1},stroke:{show:!0,width:2,colors:["transparent"]},xaxis:{categories:((a=s==null?void 0:s.monthlyRevenue)==null?void 0:a.map(i=>i.month))||[],labels:{style:{colors:f.chartText,fontSize:"12px"}},axisBorder:{show:!0,color:f.chartGrid},axisTicks:{show:!0,color:f.chartGrid}},yaxis:{labels:{formatter:i=>`â‚¹${i.toLocaleString()}`,style:{colors:f.chartText,fontSize:"12px"}},min:0},tooltip:{enabled:!0,theme:r,y:{formatter:i=>`â‚¹${i.toLocaleString()}`}},grid:{borderColor:f.chartGrid,strokeDashArray:4},responsive:[{breakpoint:768,options:{chart:{height:300},xaxis:{labels:{rotate:-45,style:{fontSize:"10px"}}},yaxis:{labels:{style:{fontSize:"10px"}}}}}]}},te=()=>({...V(),xaxis:{type:"datetime",labels:{formatter:a=>new Date(a).toLocaleDateString("en-IN"),style:{colors:f.chartText,fontSize:"12px"}},axisBorder:{show:!0,color:f.chartGrid},axisTicks:{show:!0,color:f.chartGrid}},tooltip:{theme:r,x:{formatter:a=>new Date(a).toLocaleDateString("en-IN")},y:{formatter:a=>`â‚¹${a.toLocaleString()}`}}}),ae=[{name:"Revenue",data:s.monthlyRevenue.map(a=>a.revenue)}],le=[{name:"Daily Revenue",data:s.dailyRevenue.map(a=>({x:new Date(a.day).getTime(),y:a.revenue}))}],re={chart:{type:"donut",height:350,background:f.chartBg,foreColor:f.chartText},labels:s.planDistribution.map(a=>a.name),colors:[f.primary,f.success,f.warning,f.danger,"#8B5CF6","#EC4899"],legend:{position:"bottom",labels:{colors:f.chartText,useSeriesColors:!1},markers:{width:12,height:12,radius:12},itemMargin:{horizontal:5,vertical:5}},dataLabels:{enabled:!0,style:{colors:[f.chartBg],fontSize:"12px"},dropShadow:{enabled:!1}},plotOptions:{pie:{donut:{labels:{show:!0,name:{show:!0,fontSize:"12px",color:f.chartText},value:{show:!0,fontSize:"16px",color:f.chartText,formatter:a=>`${a}`},total:{show:!0,label:"Total",color:f.chartText,formatter:()=>s.planDistribution.reduce((a,i)=>a+i.value,0)}}}}},responsive:[{breakpoint:768,options:{chart:{height:300},legend:{position:"bottom",fontSize:"10px"}}}]},oe=s.planDistribution.map(a=>a.value),se={light:{created:"bg-blue-100 text-blue-800",attempted:"bg-yellow-100 text-yellow-800",paid:"bg-green-100 text-green-800",failed:"bg-red-100 text-red-800",refunded:"bg-purple-100 text-purple-800"},dark:{created:"bg-blue-900 text-blue-200",attempted:"bg-yellow-900 text-yellow-200",paid:"bg-green-900 text-green-200",failed:"bg-red-900 text-red-200",refunded:"bg-purple-900 text-purple-200"}},ne=a=>se[r][a]||"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-200",M=()=>e.jsx("div",{className:`flex items-center justify-center h-64 ${r==="dark"?"text-gray-400":"text-gray-500"}`,children:"Loading charts..."});return e.jsx("div",{className:`min-h-screen p-4 md:p-6 transition-colors duration-300 ${r==="dark"?"bg-gray-900 text-white":"bg-gray-50 text-gray-900"}`,children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Payment Analytics Dashboard"}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-3 w-full md:w-auto",children:[e.jsx("button",{onClick:F,className:`p-2 rounded-full ${r==="dark"?"bg-gray-700 text-yellow-300":"bg-gray-200 text-gray-700"}`,"aria-label":"Toggle theme",children:r==="dark"?"ðŸŒ™":"â˜€ï¸"}),e.jsxs("div",{className:"flex gap-3 flex-wrap",children:[e.jsxs("button",{onClick:()=>ze(m),className:`flex items-center gap-2 px-4 py-2 rounded-lg transition-colors flex-1 md:flex-none ${r==="dark"?"bg-green-700 hover:bg-green-600 text-white":"bg-green-600 hover:bg-green-700 text-white"}`,children:[e.jsx(me,{size:18}),e.jsx("span",{className:"whitespace-nowrap",children:"Export Excel"})]}),e.jsx(Ae,{document:e.jsx(Ce,{payments:m,stats:s}),fileName:`payment_report_${new Date().toISOString().slice(0,10)}.pdf`,className:`flex items-center gap-2 px-4 py-2 rounded-lg transition-colors flex-1 md:flex-none ${r==="dark"?"bg-indigo-700 hover:bg-indigo-600 text-white":"bg-indigo-600 hover:bg-indigo-700 text-white"}`,children:({loading:a})=>e.jsxs(e.Fragment,{children:[e.jsx(fe,{size:18}),e.jsx("span",{className:"whitespace-nowrap",children:a?"Preparing PDF...":"Export PDF"})]})})]})]})]}),e.jsx("div",{className:`p-4 rounded-lg shadow mb-6 ${r==="dark"?"bg-gray-800":"bg-white"}`,children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(be,{className:r==="dark"?"text-gray-400":"text-gray-500"})}),e.jsxs("select",{value:N,onChange:a=>c(a.target.value),className:`block w-full pl-10 pr-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 ${r==="dark"?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300 text-gray-900"}`,children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"created",children:"Created"}),e.jsx("option",{value:"attempted",children:"Attempted"}),e.jsx("option",{value:"paid",children:"Paid"}),e.jsx("option",{value:"failed",children:"Failed"}),e.jsx("option",{value:"refunded",children:"Refunded"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(ye,{className:r==="dark"?"text-gray-400":"text-gray-500"})}),e.jsxs("select",{value:d,onChange:a=>l(a.target.value),className:`block w-full pl-10 pr-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 ${r==="dark"?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300 text-gray-900"}`,children:[e.jsx("option",{value:"all",children:"All Time"}),e.jsx("option",{value:"today",children:"Today"}),e.jsx("option",{value:"week",children:"This Week"}),e.jsx("option",{value:"month",children:"This Month"}),e.jsx("option",{value:"year",children:"This Year"}),e.jsx("option",{value:"custom",children:"Custom Range"})]})]}),d==="custom"&&e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"date",value:o,onChange:a=>t(a.target.value),className:`block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 ${r==="dark"?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300 text-gray-900"}`}),e.jsx("input",{type:"date",value:x,onChange:a=>p(a.target.value),className:`block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 ${r==="dark"?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300 text-gray-900"}`})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx("svg",{className:`h-5 w-5 ${r==="dark"?"text-gray-400":"text-gray-500"}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{type:"text",placeholder:"Search by email...",value:b,onChange:a=>v(a.target.value),className:`block w-full pl-10 pr-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 ${r==="dark"?"bg-gray-700 border-gray-600 text-white":"bg-white border-gray-300 text-gray-900"}`})]})]})}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[{title:"Total Revenue",value:`â‚¹${s.totalRevenue.toLocaleString()}`,subtitle:"All time",icon:e.jsx(pe,{size:24}),bg:"bg-indigo-100 dark:bg-indigo-900",text:"text-indigo-600 dark:text-indigo-300"},{title:"Active Subscriptions",value:s.activeSubscriptions.toLocaleString(),subtitle:"Paid plans",icon:e.jsx(we,{size:24}),bg:"bg-green-100 dark:bg-green-900",text:"text-green-600 dark:text-green-300"},{title:"Total Transactions",value:s.totalTransactions.toLocaleString(),subtitle:"All payments",icon:e.jsx(je,{size:24}),bg:"bg-blue-100 dark:bg-blue-900",text:"text-blue-600 dark:text-blue-300"},{title:"Failed Transactions",value:s.failedTransactions.toLocaleString(),subtitle:"Requires attention",icon:e.jsx(ve,{size:24}),bg:"bg-red-100 dark:bg-red-900",text:"text-red-600 dark:text-red-300"}].map((a,i)=>e.jsx("div",{className:`p-4 rounded-lg shadow ${r==="dark"?"bg-gray-800":"bg-white"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:`text-sm font-medium ${r==="dark"?"text-gray-300":"text-gray-500"}`,children:a.title}),e.jsx("p",{className:"text-xl md:text-2xl font-semibold mt-1",children:a.value}),e.jsx("p",{className:`text-xs mt-1 ${r==="dark"?"text-gray-400":"text-gray-500"}`,children:a.subtitle})]}),e.jsx("div",{className:`p-2 md:p-3 rounded-full ${a.bg} ${a.text}`,children:a.icon})]})},i))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:`p-4 md:p-6 rounded-lg shadow ${r==="dark"?"bg-gray-800":"bg-white"}`,children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"Monthly Revenue"}),s.monthlyRevenue.length>0?e.jsx("div",{className:"w-full overflow-x-auto scrollbar-hide",children:e.jsx(j.Suspense,{fallback:e.jsx(M,{}),children:e.jsx(O,{options:V(),series:ae,type:"bar",height:350,width:"100%"})})}):e.jsx("div",{className:`flex items-center justify-center h-64 ${r==="dark"?"text-gray-400":"text-gray-500"}`,children:"No revenue data available"})]}),e.jsxs("div",{className:`p-4 md:p-6 rounded-lg shadow ${r==="dark"?"bg-gray-800":"bg-white"}`,children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"Plan Distribution"}),s.planDistribution.length>0?e.jsx("div",{className:"w-full overflow-x-auto",children:e.jsx(j.Suspense,{fallback:e.jsx(M,{}),children:e.jsx(O,{options:re,series:oe,type:"donut",height:350,width:"100%"})})}):e.jsx("div",{className:`flex items-center justify-center h-64 ${r==="dark"?"text-gray-400":"text-gray-500"}`,children:"No plan distribution data available"})]})]}),e.jsxs("div",{className:`p-4 md:p-6 rounded-lg shadow mb-6 ${r==="dark"?"bg-gray-800":"bg-white"}`,children:[e.jsx("h3",{className:"text-lg font-medium mb-4",children:"Daily Revenue (Last 30 Days)"}),s.dailyRevenue.length>0?e.jsx("div",{className:"w-full overflow-x-auto scrollbar-hide",children:e.jsx(j.Suspense,{fallback:e.jsx(M,{}),children:e.jsx(O,{options:te(),series:le,type:"bar",height:350,width:"100%"})})}):e.jsx("div",{className:`flex items-center justify-center h-64 ${r==="dark"?"text-gray-400":"text-gray-500"}`,children:"No daily revenue data available"})]}),e.jsxs("div",{className:`rounded-lg shadow overflow-hidden ${r==="dark"?"bg-gray-800":"bg-white"}`,children:[e.jsxs("div",{className:`px-4 md:px-6 py-4 border-b ${r==="dark"?"border-gray-700":"border-gray-200"}`,children:[e.jsx("h3",{className:"text-lg font-medium",children:"Recent Transactions"}),e.jsxs("p",{className:`mt-1 text-sm ${r==="dark"?"text-gray-400":"text-gray-500"}`,children:[m.length," transactions found"]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsx("div",{className:"max-h-96 overflow-y-auto scrollbar-hide",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:`${r==="dark"?"bg-gray-700":"bg-gray-50"}`,children:e.jsx("tr",{children:["User","Plan","Amount","Date","Status","Transaction ID"].map(a=>e.jsx("th",{scope:"col",className:"px-4 md:px-6 py-3 text-left text-xs font-medium uppercase tracking-wider whitespace-nowrap",children:e.jsx("span",{className:r==="dark"?"text-gray-300":"text-gray-500",children:a})},a))})}),e.jsx("tbody",{className:`divide-y ${r==="dark"?"divide-gray-700 bg-gray-800":"divide-gray-200 bg-white"}`,children:m.length>0?m.map(a=>{var i,T;return e.jsxs("tr",{className:`hover:${r==="dark"?"bg-gray-700":"bg-gray-50"}`,children:[e.jsx("td",{className:"px-4 md:px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"flex items-center",children:e.jsx("div",{className:"ml-2 md:ml-4",children:e.jsx("div",{className:`text-sm font-medium ${r==="dark"?"text-white":"text-gray-900"}`,children:((i=a.userId)==null?void 0:i.email)||a.email||"N/A"})})})}),e.jsx("td",{className:"px-4 md:px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:`text-sm ${r==="dark"?"text-gray-300":"text-gray-900"}`,children:a.PlanName||a.plan||"N/A"})}),e.jsx("td",{className:"px-4 md:px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:`text-sm ${r==="dark"?"text-gray-300":"text-gray-900"}`,children:["â‚¹",((T=a.amount)==null?void 0:T.toLocaleString())||"0"]})}),e.jsx("td",{className:"px-4 md:px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:`text-sm ${r==="dark"?"text-gray-300":"text-gray-900"}`,children:new Date(a.createdAt||a.boughtAt).toLocaleDateString()})}),e.jsx("td",{className:"px-4 md:px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${ne(a.status)}`,children:a.status})}),e.jsx("td",{className:"px-4 md:px-6 py-4 whitespace-nowrap text-sm",children:e.jsx("span",{className:r==="dark"?"text-gray-400":"text-gray-500",children:a.transactionId||a.paymentId||"N/A"})})]},a._id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:`px-6 py-4 text-center text-sm ${r==="dark"?"text-gray-400":"text-gray-500"}`,children:"No transactions found"})})})]})})})]})]})})};export{Me as default};
