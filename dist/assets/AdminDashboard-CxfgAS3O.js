import{a as S,r,u as R,j as e,Q as O,m as D,R as P,S as y,I as k,T as C,p as L,U as E,W as A,X as F,Y as z}from"./index-os3KaEe5.js";const B=()=>{const a=S(),d=r.useRef(null),i=r.useRef(null),{notifications:m,loadingNotifications:g,fetchNotifications:c,markNotificationAsRead:p,getUnreadCount:N}=R(),[u,n]=r.useState(!1),[v,j]=r.useState({top:0,left:0}),l=N(),t=m.filter(s=>!s.isRead),b=()=>{if(i.current){const s=i.current.getBoundingClientRect();j({top:s.bottom+window.scrollY+8,left:s.left+window.scrollX,right:window.innerWidth-s.right-window.scrollX})}};r.useEffect(()=>{const s=h=>{d.current&&!d.current.contains(h.target)&&i.current&&!i.current.contains(h.target)&&n(!1)};return document.addEventListener("mousedown",s),document.addEventListener("touchstart",s),()=>{document.removeEventListener("mousedown",s),document.removeEventListener("touchstart",s)}},[]),r.useEffect(()=>{c();const s=setInterval(()=>{c()},1e4);return()=>clearInterval(s)},[c]),r.useEffect(()=>{if(u){c(),b();const s=()=>{b()};return window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)}},[u,c]);const f=async s=>{try{await p(s)}catch(h){console.error("Failed to mark notification as read:",h)}},x=s=>{s.stopPropagation(),b(),n(!u)},w=s=>{switch(s.isRead||f(s._id),s.type){case"feedback_submitted":case"feedback_updated":a("/admin/users");break;case"payment_processed":a("/admin/payment-management");break;case"user_registered":a("/admin/users");break;default:a("/admin/users")}n(!1)};return e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"relative",ref:i,children:e.jsxs("button",{onClick:x,className:"p-2 text-gray-500 hover:text-gray-700 focus:outline-none relative","aria-label":"Notifications",children:[e.jsx(O,{className:"text-xl md:text-2xl"}),l>0&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center",children:l>9?"9+":l})]})}),u&&e.jsxs("div",{ref:d,className:"fixed sm:absolute z-50 bg-white dark:bg-gray-800 rounded-lg shadow-lg p-2 max-h-[calc(100vh-100px)] overflow-y-auto border border-gray-200 dark:border-gray-700",style:{top:`${v.top}px`,left:"auto",right:"16px",width:"calc(100vw - 32px)",maxWidth:"24rem"},onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-2 px-2 sticky top-0 bg-white dark:bg-gray-800 py-2",children:[e.jsx("h3",{className:"font-bold text-gray-800 dark:text-white text-lg",children:"Notifications"}),l>0&&e.jsx("button",{onClick:s=>{s.stopPropagation(),t.forEach(h=>f(h._id))},className:"text-sm text-blue-500 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300",children:"Mark all as read"})]}),g?e.jsx("div",{className:"flex justify-center p-4",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})}):t.length===0?e.jsx("p",{className:"p-4 text-center text-gray-500 dark:text-gray-400",children:"No unread notifications"}):e.jsx("ul",{className:"space-y-2",children:t.map(s=>e.jsx("li",{className:"p-3 rounded-lg text-sm cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors bg-blue-50 dark:bg-blue-900/20",onClick:()=>w(s),children:e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-gray-800 dark:text-white",children:s.message}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:new Date(s.createdAt).toLocaleString()}),s.metadata&&e.jsxs("div",{className:"mt-2 text-sm bg-gray-100 dark:bg-gray-700 p-2 rounded",children:[s.type==="feedback_updated"&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-300",children:"Previous:"}),e.jsxs("span",{children:[s.metadata.previousValues.starRating," stars"]})]}),e.jsxs("p",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-300",children:"New:"}),e.jsxs("span",{children:[s.metadata.newValues.starRating," stars"]})]})]}),s.type==="payment_processed"&&e.jsxs("p",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-300",children:"Amount:"}),e.jsxs("span",{children:["$",s.metadata.amount]})]})]})]}),e.jsx("button",{onClick:h=>{h.stopPropagation(),f(s._id)},className:"text-blue-500 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 self-start ml-2 p-1",title:"Mark as read","aria-label":"Mark as read",children:e.jsx(D,{size:18})})]})},s._id))})]})]})},M=({children:a})=>{const[d,i]=r.useState(null),m=()=>{i(null),window.location.reload()};return d?e.jsx("div",{className:"flex flex-col items-center justify-center min-h-screen p-4 bg-gray-50 dark:bg-gray-900",children:e.jsxs("div",{className:"max-w-md w-full bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6",children:[e.jsx("h2",{className:"text-xl font-bold text-red-600 dark:text-red-400 mb-4",children:"Something went wrong"}),e.jsxs("details",{className:"mb-4",children:[e.jsx("summary",{className:"cursor-pointer text-sm text-gray-600 dark:text-gray-300",children:"Error details"}),e.jsx("pre",{className:"mt-2 p-2 bg-gray-100 dark:bg-gray-700 rounded text-xs overflow-auto",children:d.componentStack})]}),e.jsx("button",{onClick:m,className:"w-full px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Try Again"})]})}):e.jsx(z,{onError:(g,c)=>{console.error("ErrorBoundary caught an error:",g,c),i(c)},FallbackComponent:()=>null,children:a})},W=()=>{var f;const{user:a,isCheckingAuth:d,logout:i,loadUser:m}=R(),[g,c]=r.useState(!0),[p,N]=r.useState(!1),u=r.useRef(null),[n,v]=r.useState(!1),[j,l]=r.useState(!1),t=S();if(r.useEffect(()=>{const x=w=>{u.current&&!u.current.contains(w.target)&&N(!1)};return document.addEventListener("mousedown",x),()=>{document.removeEventListener("mousedown",x)}},[]),r.useEffect(()=>{(async()=>{try{if(await m(),!a){t("/authForm");return}if(a.role!=="admin"){t("/unauthorized");return}c(!1)}catch(w){console.error("Authentication check failed:",w),t("/authForm")}})()},[m,t]),r.useEffect(()=>{const x=()=>{window.innerWidth>=768&&l(!1)};return window.addEventListener("resize",x),()=>window.removeEventListener("resize",x)},[]),d||g)return e.jsx(P,{message:"Verifying admin access..."});const b=async()=>{try{await i(),sessionStorage.setItem("logoutMessage","Logged out successfully ðŸ‘‹"),t("/")}catch{toast.error("Logout failed. Please try again.",{duration:3e3,style:{background:"#D32F2F",color:"#fff"}})}};return e.jsx(M,{children:e.jsxs("div",{className:"flex h-screen bg-gray-100 overflow-hidden",children:[e.jsx("button",{className:"md:hidden fixed bottom-4 right-4 z-50 p-3 bg-indigo-600 text-white rounded-full shadow-lg hover:bg-indigo-700 transition-colors",onClick:()=>l(!j),"aria-label":"Toggle menu",children:j?e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}):e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})}),e.jsxs("div",{className:`hidden md:flex flex-col bg-indigo-700 text-white ${n?"w-64":"w-20"} transition-all duration-300 ease-in-out fixed h-full z-40`,children:[e.jsxs("div",{className:"p-4 flex items-center justify-between",children:[n?e.jsx("h1",{className:"text-xl font-bold whitespace-nowrap",children:"Admin Panel"}):e.jsx("span",{className:"text-xl font-bold",children:"A"}),e.jsx("button",{onClick:()=>v(!n),className:"p-1 rounded-full hover:bg-indigo-600 focus:outline-none","aria-label":n?"Collapse sidebar":"Expand sidebar",children:n?e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}):e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]}),e.jsxs("nav",{className:"mt-6 overflow-y-auto flex-1",children:[e.jsx(o,{icon:e.jsx(y,{className:"w-6 h-6"}),text:"Dashboard",active:!0,sidebarOpen:n,onClick:()=>t("/admin")}),e.jsx(o,{icon:e.jsx(k,{className:"w-6 h-6"}),text:"Manage Users",sidebarOpen:n,onClick:()=>t("/admin/users")}),e.jsx(o,{icon:e.jsx(C,{className:"w-6 h-6"}),text:"Manage Plans And Events",sidebarOpen:n,onClick:()=>t("/admin/plan-event-management")}),e.jsx(o,{icon:e.jsx(L,{className:"w-6 h-6"}),text:"Payment Analytics",sidebarOpen:n,onClick:()=>t("/admin/payment-analytics")}),e.jsx(o,{icon:e.jsx(E,{className:"w-6 h-6"}),text:"Manage College Data",sidebarOpen:n,onClick:()=>t("/admin/college-data")}),e.jsx(o,{icon:e.jsx(A,{className:"w-6 h-6"}),text:"Settings",sidebarOpen:n,onClick:()=>t("/admin/settings")})]})]}),j&&e.jsxs("div",{className:"md:hidden fixed inset-0 z-40",children:[e.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50",onClick:()=>l(!1)}),e.jsxs("div",{className:"relative flex flex-col w-64 h-full bg-indigo-700 text-white",children:[e.jsxs("div",{className:"p-4 flex items-center justify-between",children:[e.jsx("h1",{className:"text-xl font-bold",children:"Admin Panel"}),e.jsx("button",{onClick:()=>l(!1),className:"p-1 rounded-full hover:bg-indigo-600 focus:outline-none","aria-label":"Close menu",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("nav",{className:"mt-6 overflow-y-auto flex-1",children:[e.jsx(o,{icon:e.jsx(y,{className:"w-6 h-6"}),text:"Dashboard",active:!0,sidebarOpen:!0,onClick:()=>{t("/admin"),l(!1)}}),e.jsx(o,{icon:e.jsx(k,{className:"w-6 h-6"}),text:"Manage Users",sidebarOpen:!0,onClick:()=>{t("/admin/users"),l(!1)}}),e.jsx(o,{icon:e.jsx(C,{className:"w-6 h-6"}),text:"Manage Plans And Events",sidebarOpen:!0,onClick:()=>{t("/admin/plan-event-management"),l(!1)}}),e.jsx(o,{icon:e.jsx(L,{className:"w-6 h-6"}),text:"Payment Analytics",sidebarOpen:!0,onClick:()=>{t("/admin/payment-analytics"),l(!1)}}),e.jsx(o,{icon:e.jsx(E,{className:"w-6 h-6"}),text:"Manage College Data",sidebarOpen:!0,onClick:()=>{t("/admin/college-data"),l(!1)}}),e.jsx(o,{icon:e.jsx(A,{className:"w-6 h-6"}),text:"Settings",sidebarOpen:!0,onClick:()=>{t("/admin/settings"),l(!1)}})]})]})]}),e.jsxs("div",{className:`flex-1 flex flex-col overflow-hidden transition-all duration-300 ${n?"md:ml-64":"md:ml-20"}`,children:[e.jsx("header",{className:"bg-white shadow-sm z-10",children:e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 sm:px-6",children:[e.jsx("h2",{className:"text-lg sm:text-xl font-semibold text-gray-800 truncate",children:"Admin Dashboard"}),e.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-4",children:[e.jsx("div",{className:"relative",children:e.jsx(B,{})}),e.jsxs("div",{className:"relative",ref:u,children:[e.jsxs("button",{className:"flex items-center space-x-1 sm:space-x-2 focus:outline-none",onClick:()=>N(!p),"aria-label":"User menu",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-indigo-500 flex items-center justify-center text-white font-semibold",children:((f=a==null?void 0:a.fullName)==null?void 0:f.charAt(0))||"A"}),e.jsx("span",{className:"hidden sm:inline text-sm sm:text-base text-gray-700 truncate max-w-xs",children:(a==null?void 0:a.fullName)||"Admin"}),e.jsx("svg",{className:`w-4 h-4 text-gray-500 transition-transform duration-200 ${p?"transform rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),p&&e.jsxs("div",{className:"absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-20 border border-gray-200",children:[e.jsxs("div",{className:"px-4 py-2 text-sm text-gray-700 border-b border-gray-100",children:[e.jsx("div",{className:"font-medium truncate",children:a==null?void 0:a.email}),e.jsx("div",{className:"text-xs text-gray-500",children:"Admin"})]}),e.jsx("button",{onClick:b,className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-colors duration-200",children:"Logout"})]})]})]})]})}),e.jsx("main",{className:"flex-1 overflow-y-auto p-4 sm:p-6 bg-gray-50",children:e.jsx(M,{children:e.jsx(F,{})})})]})]})})},o=({icon:a,text:d,active:i=!1,sidebarOpen:m,onClick:g})=>e.jsxs("button",{onClick:g,className:`flex items-center w-full px-4 py-3 mt-2 ${i?"bg-indigo-600":"hover:bg-indigo-600"} rounded-lg transition-colors duration-200 focus:outline-none`,children:[e.jsx("span",{className:`${i?"text-white":"text-indigo-200"}`,children:a}),m&&e.jsx("span",{className:"ml-4 font-medium",children:d})]});export{W as default};
